hostname {{ device_name }}

{% include 'snippets/vlans.j2' %}

vlan {{ mgmt_vlan_id }}
   name {{ mgmt_vlan_name }}

interface vlan {{ mgmt_vlan_id }}
   ip address {{ mgmt_svi_ip }}/{{ mgmt_svi_mask }}
   active-gateway ip {{ mgmt_svi_ip }}
   active-gateway mac {{ active_gateway_mac }}

{% include 'snippets/mst.j2' %}

{% if vsx_pair_id %}
vsx
   role {{ vsx_role }}
{% if vsx_keepalive_peer_ip %}
   keepalive peer {{ vsx_keepalive_peer_ip }} source {{ vsx_keepalive_source_ip }} vrf {{ vsx_keepalive_vrf }}
{% endif %}
   isl lag 256
{% endif %}

interface lag 256
   description VSX ISL
   no routing
   vlan trunk native {{ mgmt_vlan_id }}
{% if design_mode == 'L3' %}
   vlan trunk allowed {{ mgmt_vlan_id }}
{% else %}
   vlan trunk allowed all
{% endif %}
   no shutdown

interface {{ core_vsx.isl_port_1 }}
   description VSX ISL Member
   no routing
   vlan trunk native {{ mgmt_vlan_id }}
{% if design_mode == 'L3' %}
   vlan trunk allowed {{ mgmt_vlan_id }}
{% else %}
   vlan trunk allowed all
{% endif %}
   no shutdown
   lag 256

interface {{ core_vsx.isl_port_2 }}
   description VSX ISL Member
   no routing
   vlan trunk native {{ mgmt_vlan_id }}
{% if design_mode == 'L3' %}
   vlan trunk allowed {{ mgmt_vlan_id }}
{% else %}
   vlan trunk allowed all
{% endif %}
   no shutdown
   lag 256

{% include 'snippets/svis.j2' %}

{% if design_mode == 'L3' %}
{% include 'snippets/core_access_downlinks_l3.j2' %}
{% else %}
{% include 'snippets/core_access_downlinks.j2' %}
{% endif %}

{% include 'snippets/aaa_clearpass_stub.j2' %}

{% if design_mode == 'L3' %}
router ospf {{ ospf_process_id }}
   router-id {{ ospf_router_id }}
   redistribute connected
{% endif %}
